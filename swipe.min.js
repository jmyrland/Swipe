/*
 * SwipeFade 1.0 
 *
 * JÃ¸rn Myrland, Peanuts
 * 
 * Based on Swipe.js 1.0
 *
 * Brad Birdsall, Prime
 * Copyright 2011, Licensed GPL & MIT
 *
*/
;window.Swipe=function(element,options){if(!element)return null;var _this=this;this.options=options||{};this.index=this.options.startSlide||0;this.speed=this.options.speed||300;this.callback=this.options.callback||function(){};this.delay=this.options.auto||0;this.breakPoint=this.options.breakPoint||0;this.container=element;this.element=this.container.children[0];this.container.style.overflow='hidden';this.element.style.listStyle='none';this.element.style.margin=0;this.setup();this.onResize();this.begin();if(this.element.addEventListener){this.element.addEventListener('touchstart',this,false);this.element.addEventListener('touchmove',this,false);this.element.addEventListener('touchend',this,false);this.element.addEventListener('touchcancel',this,false);this.element.addEventListener('webkitTransitionEnd',this,false);this.element.addEventListener('msTransitionEnd',this,false);this.element.addEventListener('oTransitionEnd',this,false);this.element.addEventListener('transitionend',this,false);window.addEventListener('resize',this,false);}};Swipe.prototype={setup:function(){this.slides=this.element.children;this.length=this.slides.length;this.width=Math.ceil(("getBoundingClientRect"in this.container)?this.container.getBoundingClientRect().width:this.container.offsetWidth);if(this.width===0&&typeof window.getComputedStyle==='function'){this.width=window.getComputedStyle(this.container,null).width.replace('px','');}
if(!this.width)return null;this.container.style.visibility='hidden';this.element.style.width=Math.ceil(this.slides.length*this.width)+'px';var positionStyle=$(window).outerWidth()>this.breakPoint?'absolute':'relative';var index=this.slides.length;while(index--){var el=this.slides[index];el.style.width=this.width+'px';el.style.display='table-cell';el.style.verticalAlign='top';el.style.position=positionStyle;}
this.slide(this.index,0);this.container.style.visibility='visible';},slide:function(index,duration){var style=this.element.style;if(duration==undefined){duration=this.speed;}
if(this.breakPoint<$(window).outerWidth()){var nextElement=this.element.children[(index-1<this.length-1?index:0)];if(Modernizr.csstransitions){$(nextElement).siblings().each(function(){style=$(this)[0].style;style.webkitTransitionDuration=style.MozTransitionDuration=style.msTransitionDuration=style.OTransitionDuration=style.transitionDuration=duration+'ms';style.opacity='0';style.visibility='hidden';});style=nextElement.style;style.webkitTransitionDuration=style.MozTransitionDuration=style.msTransitionDuration=style.OTransitionDuration=style.transitionDuration=duration+'ms';style.opacity='1';style.visibility='visible';}else{_this=this;$(nextElement).siblings().fadeOut(duration);$(nextElement).fadeIn(duration,function(){_this.transitionEnd();});}}
else
{if(Modernizr.csstransforms&&Modernizr.csstransitions){style.webkitTransitionDuration=style.MozTransitionDuration=style.msTransitionDuration=style.OTransitionDuration=style.transitionDuration=duration+'ms';style.MozTransform=style.webkitTransform='translate3d('+-(index*this.width)+'px,0,0)';style.msTransform=style.OTransform='translateX('+-(index*this.width)+'px)';}
else{_this=this;$(_this.element).stop().animate({left:-(index*_this.width)},duration,'easeInOutQuad',function(){_this.transitionEnd();});}}
this.index=index;},getPos:function(){return this.index;},prev:function(delay){this.delay=delay||0;clearTimeout(this.interval);if(this.index)this.slide(this.index-1,this.speed);},next:function(delay){this.delay=delay||0;clearTimeout(this.interval);if(this.index<this.length-1)this.slide(this.index+1,this.speed);else this.slide(0,this.speed);},begin:function(){var _this=this;if(this.interval)clearTimeout(this.interval);this.interval=(this.delay)?setTimeout(function(){_this.next(_this.delay);},this.delay):0;},stop:function(){this.delay=0;clearTimeout(this.interval);},resume:function(){this.delay=this.options.auto||0;this.begin();},handleEvent:function(e){switch(e.type){case'touchstart':if(this.breakPoint>=$(window).outerWidth())this.onTouchStart(e);break;case'touchmove':if(this.breakPoint>=$(window).outerWidth())this.onTouchMove(e);break;case'touchcancel':case'touchend':if(this.breakPoint>=$(window).outerWidth())this.onTouchEnd(e);break;case'webkitTransitionEnd':case'msTransitionEnd':case'oTransitionEnd':case'transitionend':this.transitionEnd(e);break;case'resize':this.onResize();this.setup();break;}},transitionEnd:function(e){if(this.delay)this.begin();this.callback(e,this.index,this.slides[this.index]);},onResize:function(){var style=this.element.style,index=this.index;if(this.breakPoint<$(window).outerWidth()){if(Modernizr.csstransforms&&Modernizr.csstransitions){style.webkitTransitionDuration=style.MozTransitionDuration=style.msTransitionDuration=style.OTransitionDuration=style.transitionDuration='0ms';style.MozTransform=style.webkitTransform='translate3d(0px,0,0)';style.msTransform=style.OTransform='translateX(0px)';}else{$(this.element).stop().css({left:'0px'});}
var siblings=$(this.element.children[index]).siblings();if(Modernizr.csstransitions){siblings.each(function(){$(this)[0].style.webkitTransitionDuration=style.MozTransitionDuration=style.msTransitionDuration=style.OTransitionDuration=style.transitionDuration='0ms';$(this)[0].style.opacity='0';});}else{siblings.fadeOut(0);}}
else{$(this.element.children).stop().show().css({'opacity':'1','visibility':'visible'});if(Modernizr.csstransforms&&Modernizr.csstransitions){style.webkitTransitionDuration=style.MozTransitionDuration=style.msTransitionDuration=style.OTransitionDuration=style.transitionDuration='0ms';style.MozTransform=style.webkitTransform='translate3d('+-(this.index*this.width)+'px,0,0)';style.msTransform=style.OTransform='translateX('+-(this.index*this.width)+'px)';}else{_this=this;$(this.element).stop().css({left:-(_this.index*_this.width)+'px'});}}
this.stop();this.resume();},onTouchStart:function(e){this.start={pageX:e.touches[0].pageX,pageY:e.touches[0].pageY,time:Number(new Date())};this.isScrolling=undefined;this.deltaX=0;this.element.style.MozTransitionDuration=this.element.style.webkitTransitionDuration=0;e.stopPropagation();},onTouchMove:function(e){if(e.touches.length>1||e.scale&&e.scale!==1)return;this.deltaX=e.touches[0].pageX-this.start.pageX;if(typeof this.isScrolling=='undefined'){this.isScrolling=!!(this.isScrolling||Math.abs(this.deltaX)<Math.abs(e.touches[0].pageY-this.start.pageY));}
if(!this.isScrolling){e.preventDefault();clearTimeout(this.interval);this.deltaX=this.deltaX/((!this.index&&this.deltaX>0||this.index==this.length-1&&this.deltaX<0)?(Math.abs(this.deltaX)/this.width+1):1);this.element.style.MozTransform=this.element.style.webkitTransform='translate3d('+(this.deltaX-this.index*this.width)+'px,0,0)';e.stopPropagation();}},onTouchEnd:function(e){var isValidSlide=Number(new Date())-this.start.time<250&&Math.abs(this.deltaX)>20||Math.abs(this.deltaX)>this.width/2,isPastBounds=!this.index&&this.deltaX>0||this.index==this.length-1&&this.deltaX<0;if(!this.isScrolling){this.slide(this.index+(isValidSlide&&!isPastBounds?(this.deltaX<0?1:-1):0),this.speed);this.stop();}
e.stopPropagation();}};
